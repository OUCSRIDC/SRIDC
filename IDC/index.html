<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=0,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>主页</title>
    <script src="js/jquery-1.11.1.min.js"></script>
    <script src="js/Tabullet.js"></script>
    <script type="text/javascript" src="extends/extends.js"></script>
    <link rel="stylesheet" href="style.css" type="text/css" />
    <link rel="stylesheet" href="mobile.css" type="text/css" />
    <link rel="stylesheet" href="media.css" type="text/css" />
    <link rel="stylesheet" href="css/font-awesome.min.css">

    <script>
    $(function() {
        var source = [{
            id: 1,
            name: "Aditya Purwa",
            ip: "Admin"
        }, {
            id: 2,
            name: "Aditya Avaga",
            ip: "Manager"
        }, {
            id: 3,
            name: "Aditya Myria",
            ip: "User"
        }, {
            id: 4,
            name: "Lucent Serentia",
            ip: "LOD"
        }, {
            id: 5,
            name: "Hayden Bapalthiel",
            ip: "King"
        }, ];

        function resetTabullet() {
            $("#table").tabullet({
                data: source,
                action: function(mode, data) {
                    console.dir(mode);
                    if (mode === 'save') {
                        source.push(data);

                            //新增数据
                          $.ajax({
                              type: "POST",
                              url: "api/info/setHostInfo.ashx",
                              data: { 
                                username: sessionStorage.getItem("NumberId"), 
                                ip: $("#save1").val(),
                                name: $("#save2").val() 
                            },
                              async: false,
                              dataType: "json",
                              success: function (dat) {
                                  if (dat.status == 200) {
                                      source.push(data);
                                  }
                                  
                              }
                          });

                    }
                    if (mode === 'edit') {
                        for (var i = 0; i < source.length; i++) {
                            if (source[i].id == data.id) {
                                source[i] = data;
                            }
                        }
                    }
                    if (mode == 'delete') {
                        for (var i = 0; i < source.length; i++) {
                            if (source[i].id == data) {
                                source.splice(i, 1);
                                break;
                            }
                        }
                    }
                    resetTabullet();
                }
            });
        }


            //连接数据
            $.ajax({
                url: 'api/info/getHostInfoAll.ashx',
                data: {
                    username: sessionStorage.getItem("NumberId")
                },
                type: 'post',
                cache: false,
                async: false,
                dataType: 'json',
                success: function (data) {
                    //console.log(data);
                    if (data.status == '200') {
                        source.push(data);
                        //循环后台传过来的Json数组
                        for (var i = 0; i < data.length; i++) {
                            var datas = data[i];
                            //把数据添加到页面
                            $("#table").children("tbody").append("<tr><th>" + datas.id + "</th><td id='" + datas.ip + "'>" + datas.ip + "</td><td>" + data.name + "</td><td><button></button></td></tr>");
                        }
                        //导航栏添加用户名
                        $("#userName").value(data.username);
                    }
                },
            });

        resetTabullet();
    });
    </script>
</head>

<body>
    <!--Start||nav-->
    <div class="wrapper nav wp-navi" id="nav">
        <div class="inner">
            <!--导航-->
            <div class="navbar" frag="面板1">
                <div class="navbox" frag="窗口1">
                    <div frag="窗口内容">
                        <div class="navi-slide-head">
                            <!-- <h3 class="navi-slide-title">导航</h3> -->
                            <a class="navi-slide-arrow"></a>
                            <a class="navi-slide-scan"></a>
                        </div>
                        <!--[NaviStructBegin]-->
                        <ul class="wp-menu clearfix" data-nav-aside='{"title":"导航","index":0}'>
                            <!--[NaviItemCycleBegin]-->
                            <li class="menu-item {级别样式}">
                                <a class="menu-link" href="{栏目URL}" target="{打开方式}">
                                    <p id="userName">用户名</p>
                                    <img class="userhead" src="images/head.jpg" height="30" width="30" alt="">
                                </a>
                                <!--[MenuStructBegin]-->
                                <em class="menu-switch-arrow"></em>
                                <ul class="sub-menu clearfix">
                                    <!--[MenuItemCycleBegin]-->
                                    <li class="sub-item {级别样式}">
                                        <a class="sub-link" href="{栏目URL}" target="{打开方式}">个人中心</a>
                                        <!--[SubMenuList]-->
                                    </li>
                                    <li class="sub-item {级别样式}">
                                        <a class="sub-link" href="{栏目URL}" target="{打开方式}">设置</a>
                                        <!--[SubMenuList]-->
                                    </li>
                                    <!--[MenuItemCycleEnd]-->
                                </ul>
                                <!--[MenuStructEnd]-->
                            </li>
                            <!--[NaviItemCycleEnd]-->
                        </ul>
                        <!--[NaviStructEnd]-->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--aside导航-->
    <div class="wp-navi-aside" id="wp-navi-aside">
        <div class="aside-inner">
            <div class="navi-aside-wrap"></div>
        </div>
        <div class="navi-aside-mask"></div>
    </div>
    <!--End||nav-->
    <!--Start||head-->
    <div class="wrapper header" id="header">
        <div class="inner">
            <!--头部信息-->
            <div class="head">
                <!--logo开始-->
                <!-- <div class="sitelogo" frag="面板01">
                    <a class="navi-aside-toggle"></a>
                    <div class="sitelogocon" frag="窗口01" portletmode="simpleSiteAttri">
                        <span frag="窗口内容"><a href="{站点URL}" title="返回{站点名称}首页">{站点Logo}</a></span>
                    </div>
                </div> -->
                <!--站点名称-->
                <div class="sitetitle" frag="面板02">
                    <div class="sitetitlecon" frag="窗口02" portletmode="simpleSiteName">
                        <span frag="窗口内容">IPV6网络IDC机房托管服务监管系统</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--End||head-->
    <!--搜索开始-->
    <div class="wrapper mbanner" id="mbanner">
        <div class="inner clearfix">
            <div class="banner" frag="面板2">
                <div frag="窗口2">
                    <div frag="窗口内容">
                        <!--[InfoCycleBegin]-->
                        <form action="" method="post">
                            <input type="text" name="username" class="searchbox" value="Search">
                            <a href=""><i class="fa fa-search fa-2x"></i></a>
                        </form>
                        <!--[InfoCycleEnd]-->
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--//搜索结束-->
    <!--表格开始-->
    <div class="container wrapper content" id="container">
        <div class="row inner clearfix">
            <div class="col-sm-12 mod clearfix">
                <table class="table table-hover" id="table">
                    <thead>
                        <tr data-tabullet-map="id">
                            <th width="50" data-tabullet-map="_index" data-tabullet-readonly="true">No</th>
                            <th data-tabullet-map="ip">IP</th>
                            <th data-tabullet-map="name">Name</th>
                            <th width="50" data-tabullet-type="edit"></th>
                            <th width="50" data-tabullet-type="delete"></th>
                        </tr>
                    </thead>
                </table>
            </div>
        </div>
    </div>
    <!--表格结束-->



    <script type="text/javascript" src="js/app.js"></script>
    <script src="js/jquery.cookie.js"></script>
    <script src="js/json2.js"></script>
    <script src="js/jquery.jsoncookie.js"></script>


    <script type="text/javascript">
        $(function () {

            // 初始化SDAPP
            new SDAPP({
                'focus': {
                    zWidth: 1000,
                    zHeight: 366,
                    pagination: true
                },
                "menu": {
                    type: "slide"
                }
            });

            // 点击跳转到detail页面
            var det = $("#table").children("tbody").children("tr").not(":first");
            //console.log(det);
            det.click(function () {
                //点击时获取改行的id即ip
                var ip = $(this).attr('data-tabullet-id');
                //存入session，从detail页读取session
                sessionStorage.setItem("hostip", ip);
                console.log(ip);
                location.href = 'detail.html';
            });

        });

    </script>
</body>
</html>
